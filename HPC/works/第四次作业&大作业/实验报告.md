# 基于SYCL实现神经网络推理
## 实验背景
### GPU
GPU(图形处理器)是处理计算机图形的专用设备。近十年来，由于高清晰度复杂图形实时处理的需求，GPU发展成为高并行度、多线程、多核的处理器。目前主流GPU的运算能力已超过主流通用CPU，从发展趋势上看将来差距会越来越大。GPU卓越的性能对开发GPU(使用GPU进行通用计算)非常具有吸引力。最初GPU需要将非图形应用映射为图形应用的方式，这个处理过程与图形硬件紧密相关，程序实现非常困难。
面对并行化程序在不同硬件上开发的困难，Khronos Group提出并组织开发了SYCL（Single-source C++ Heterogeneous Language），一种用于编写并行程序的开放标准。SYCL基于C++编程语言，并提供了一组扩展，使程序员能够在不同类型的计算设备上编写并行代码，包括CPU、GPU和FPGA等。
Khronos Group是一个非营利性的行业联盟，致力于制定和推广开放的图形和计算标准。该组织由多家领先的硬件和软件公司组成，包括AMD、ARM、Intel、NVIDIA等。Khronos Group负责管理和推动SYCL的发展，并确保其成为一个开放、跨平台的并行编程标准。
SYCL的一个重要特点是它采用了单一源代码（Single-source）的编程模型，可以在同一个源文件中编写并行代码，而不需要为不同的设备编写不同的代码。SYCL使用了C++模板和运行时系统，以便在编译时将并行代码映射到不同的设备上。
### 神经网络算法设计
GPU上神经网络前向传播算法基本过程是逐层计算各层的所有神经元的值。
输入层神经元值已知，其余每层有一个Kernel函数来计算该层的所有神经元的值，上述的神经网络需要4个Kernel函数。并行计算只能体现在一层中，不同层之间没有并行性。
首先将输入层的神经元值和每层的权值保存在5个数组中，并从host内存传递到device内存。由于每层的权值是不变的，所以可以将这些权值传递到device的常量内存中，由于常量内存有cache，这比放到全局内存的存取速度要快很多。在device中为第二到第五层的神经元值分配内存空间，第一个Kernel函数根据输入层的神经元值和权值计算第二层神经元值，第二个Kernel函数根据第二层的神经元值和权值计算第三层神经元值，如此往下，第四个Kernel函数计算出第五层即输出层的值，然后将该值从device内存传递到host内存。神经网络的连接体现在每个Kernel函数处理计算过程里。

## 实验设计
一般的，神经网络的前向传播过程可以简化为如下的过程：
矩阵A作为左乘矩阵和矩阵B[i]作为右乘矩阵，进行矩阵乘法得到矩阵C；
对矩阵C的每一项加上一个偏置项bias，并用激活函数进行激活；
将矩阵C作为新的矩阵A，与矩阵B[i+1]进行下一轮的运算。
为了模拟实际训练场景，将矩阵A设定为60000\*1024的稀疏矩阵，矩阵B均为1024\*1024的稠密矩阵，并选取ReLU函数作为激活函数。


## 实验内容

## 实验环境

CPU: Intel Xeon E-2176G Processor

| Lithography | 14 nm |
|--------|--------|
| Cache|12 MB Intel® Smart Cache|
|Total Cores|6|
|Total Threads|12|
|Max Turbo Frequency|4.70 GHz|
|Processor Graphics|Intel® UHD Graphics P630|

GPU: Intel® Iris® Xe MAX Graphics

|FLOPS|921.6 GFLOPS|
|--------|--------|
|GPU base clock speed|350 MHz|
|Gpu memory speed|System Shared|
|Memory bandwidth|System Shared|
|RAM|System Shared|


GPU: Intel® Iris® Xe MAX Graphics

|FLOPS|2.48 TFLOPS|
|--------|--------|
|GPU base clock speed|300 MHz|
|Gpu memory speed|2133 MHz|
|Memory bandwidth| 68.26 GB/s|
|RAM|4GB|


## 算法设计

## 实验结果 测试

## 附录
### devcloud上机

### 遇到问题

### 参考文献
[[Data Parallel C++ Mastering DPC++ for Programming of Heterogeneous Systems using C++ and SYCL    ---James Reinders; Ben Ashbaugh; James Brodman; Michael Kinsner; John Pennycook; Xinmin Tian]]



# 摘要
